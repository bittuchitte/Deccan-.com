<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Deccan</title>
<style>
body { background-color: #000; color: #0f0; font-family: 'Courier New', Courier, monospace; padding: 20px; }
h1 { text-align: center; text-shadow: 0 0 10px #0f0; }
.menu { display: flex; justify-content: center; gap: 20px; margin-top: 30px; flex-wrap: wrap; }
.menu button { padding: 18px; background-color: #111; border: 2px solid #0f0; border-radius: 10px; font-size: 14px; color: #0f0; cursor: pointer; width: 140px; }
.menu button:hover { background-color: #0f0; color: #000; }

.section { margin-top: 30px; text-align: center; }
.chatBox { border: 2px solid #0f0; border-radius: 10px; padding: 10px; width: 400px; height: 300px; overflow-y: auto; margin: 10px auto; background-color: #111; text-align: left; }
input { background-color: #000; border: 1px solid #0f0; border-radius: 5px; padding: 10px; color: #0f0; }
button.sendBtn { padding: 10px; background-color: #0f0; color: #000; border: none; border-radius: 5px; cursor: pointer; }
</style>
</head>
<body>
<h1>Welcome, <span id="userName"></span></h1>

<div class="menu">
<button onclick="openGroupChat()">Group Chat</button>
<button onclick="showPrivateChatUsers()">Chat with Friend</button>
<button onclick="callUser()">Call User</button>
<button onclick="viewCallHistory()">Call Records</button>
<button onclick="viewAccounts()">View All Accounts</button>
<button onclick="logout()">Logout</button>
</div>

<div id="content"></div>
<script>
let currentUser = JSON.parse(localStorage.getItem('currentUser'));
if(!currentUser) window.location.href = "login.html";
document.getElementById('userName').innerText = currentUser.codename;

// GROUP CHAT
function openGroupChat() {
    document.getElementById('content').innerHTML = `
        <div class='section'>
        <h2>Group Chat</h2>
        <div id='groupChatBox' class='chatBox'></div>
        <input id='groupInput' placeholder='Type message...' style='width:300px; margin-right:5px;'>
        <button class='sendBtn' onclick='sendGroupMessage()'>Send</button>
        </div>`;
    loadGroupMessages();
}

function loadGroupMessages() {
    let msgs = JSON.parse(localStorage.getItem("groupChat") || "[]");
    let box = document.getElementById("groupChatBox");
    box.innerHTML = msgs.map(m => `<div><b>${m.sender}:</b> ${m.text}</div>`).join('');
    box.scrollTop = box.scrollHeight;
}

function sendGroupMessage() {
    let input = document.getElementById("groupInput");
    if(!input.value.trim()) return;
    
    let msgs = JSON.parse(localStorage.getItem("groupChat") || "[]");
    msgs.push({ sender: currentUser.codename, text: input.value });
    localStorage.setItem("groupChat", JSON.stringify(msgs));
    input.value="";
    loadGroupMessages();
}

// PRIVATE CHAT
let selectedUser=null;

function showPrivateChatUsers() {
    let users = JSON.parse(localStorage.getItem('users')||'[]').filter(u=>u.userid!==currentUser.userid);
    document.getElementById('content').innerHTML =
    "<h2>Select Friend</h2><ul>" +
    users.map(u=>`<li onclick='openPrivateChat("${u.userid}","${u.codename}")' style='cursor:pointer;margin:6px 0;'>${u.name} (${u.codename})</li>`).join('')
    + "</ul>";
}

function privateKey(){ return "private_"+currentUser.userid+"_"+selectedUser; }

function openPrivateChat(id,codename){
    selectedUser=id;
    document.getElementById('content').innerHTML = `
        <h2>Chat with ${codename}</h2>
        <div id='pBox' class='chatBox'></div>
        <input id='pInput' placeholder='Type message...' style='width:300px;margin-right:5px;'>
        <button class='sendBtn' onclick='sendPrivateMsg()'>Send</button>`;
    loadPrivateMessages();
}

function loadPrivateMessages(){
    let msgs=JSON.parse(localStorage.getItem(privateKey())||"[]");
    let box=document.getElementById("pBox");
    box.innerHTML=msgs.map(m=>`<div><b>${m.sender}:</b> ${m.text}</div>`).join('');
    box.scrollTop=box.scrollHeight;
}

function sendPrivateMsg(){
    let input=document.getElementById("pInput");
    if(!input.value.trim()) return;
    let msgs=JSON.parse(localStorage.getItem(privateKey())||"[]");
    msgs.push({sender:currentUser.codename,text:input.value});
    localStorage.setItem(privateKey(),JSON.stringify(msgs));
    input.value="";
    loadPrivateMessages();
}

// CALL
let callUserID=null;
function callUser(){
    let users=JSON.parse(localStorage.getItem("users")||"[]").filter(u=>u.userid!==currentUser.userid);
    document.getElementById("content").innerHTML="<h2>Call User</h2><ul>"+ 
    users.map(u=>`<li onclick='startCall("${u.userid}","${u.codename}")' style='cursor:pointer;margin:6px 0;'>${u.name} (${u.codename})</li>`).join('')
    +"</ul>";
}

function startCall(id,cn){
    callUserID=id;
    saveCallHistory(cn);
    document.getElementById("content").innerHTML=`
    <h2>Calling ${cn}...</h2>
    <div style='font-size:22px;margin:20px;'>ðŸ”Š Ringing...</div>
    <button class='sendBtn' onclick='viewCallHistory()'>End Call</button>`;
}

// CALL HISTORY
function saveCallHistory(cn){
    let key="callHistory_"+currentUser.userid;
    let list=JSON.parse(localStorage.getItem(key)||"[]");
    list.push({user:cn,time:new Date().toLocaleString()});
    localStorage.setItem(key,JSON.stringify(list));
}

function viewCallHistory(){
    let key="callHistory_"+currentUser.userid;
    let list=JSON.parse(localStorage.getItem(key)||"[]");
    if(!list.length){
        document.getElementById('content').innerHTML="<h2>No Call Records</h2>";
        return;
    }
    document.getElementById("content").innerHTML=
    "<h2>Call Records</h2><ul style='text-align:left;display:inline-block;'>"+
    list.map(h=>`<li style='margin:6px 0;'>${h.user} - ${h.time}</li>`).join('')
    +"</ul>";
}

// ACCOUNTS + LOGOUT
function viewAccounts(){
    let users=JSON.parse(localStorage.getItem("users")||"[]");
    document.getElementById("content").innerHTML=
    "<h2>All Accounts</h2><ul style='text-align:left;display:inline-block;'>"+
    users.map(u=>`<li style='margin:6px 0;'>${u.name} (${u.codename})</li>`).join('')
    +"</ul>";
}

function logout(){
    localStorage.removeItem("currentUser");
    window.location.href="login.html";
}
</script>
</body>
</html>
